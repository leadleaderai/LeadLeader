<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Header -->
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">
      ✉️ Contact Us
    </h1>
    <p class="text-lg text-gray-600 dark:text-gray-300">
      Have questions? We'd love to hear from you. Send us a message and we'll respond as soon as possible.
    </p>
  </div>

  <!-- Rate Limit Warning -->
  <div id="cooldownBanner" class="hidden bg-yellow-100 dark:bg-yellow-900 border-l-4 border-yellow-500 p-4 mb-6">
    <p class="text-sm text-yellow-800 dark:text-yellow-200">
      ⏱️ Please wait <span id="cooldownSeconds" class="font-bold"></span> seconds before submitting again.
    </p>
  </div>

  <!-- Contact Form -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
    <form id="contactForm" class="space-y-6">
      <!-- Name -->
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Your Name
        </label>
        <input type="text" id="name" name="name" required
               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
               placeholder="John Doe">
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Email Address
        </label>
        <input type="email" id="email" name="email" required
               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
               placeholder="john@example.com">
      </div>

      <!-- Message -->
      <div>
        <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Message
        </label>
        <textarea id="message" name="message" rows="6" required
                  class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"
                  placeholder="Tell us about your needs..."></textarea>
      </div>

      <!-- Honeypot (hidden) -->
      <input type="text" name="website" id="website" style="position:absolute;left:-5000px" tabindex="-1" autocomplete="off">

      <!-- hCaptcha (if configured) -->
      <% if (typeof hcaptchaSitekey !== 'undefined' && hcaptchaSitekey) { %>
        <div class="h-captcha" data-sitekey="<%= hcaptchaSitekey %>"></div>
      <% } %>

      <!-- Submit Button -->
      <div>
        <button type="submit" id="submitBtn"
                class="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition font-medium">
          Send Message
        </button>
      </div>

      <!-- Status Messages -->
      <div id="status" class="hidden"></div>
    </form>
  </div>

  <!-- Contact Info -->
  <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="text-center">
      <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mx-auto mb-3">
        <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </div>
      <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Email</h3>
      <p class="text-gray-600 dark:text-gray-400 text-sm">support@leadleader.ai</p>
    </div>

    <div class="text-center">
      <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center mx-auto mb-3">
        <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Response Time</h3>
      <p class="text-gray-600 dark:text-gray-400 text-sm">Within 24 hours</p>
    </div>

    <div class="text-center">
      <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center mx-auto mb-3">
        <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z" />
        </svg>
      </div>
      <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Support</h3>
      <p class="text-gray-600 dark:text-gray-400 text-sm">24/7 availability</p>
    </div>
  </div>
</div>

<% if (typeof hcaptchaSitekey !== 'undefined' && hcaptchaSitekey) { %>
  <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
<% } %>

<script>
// ═══════════════════════════════════════════════════════════
// CONTACT FORM HANDLER
// ═══════════════════════════════════════════════════════════

const contactForm = document.getElementById('contactForm');
const submitBtn = document.getElementById('submitBtn');
const statusDiv = document.getElementById('status');
const cooldownBanner = document.getElementById('cooldownBanner');
const cooldownSeconds = document.getElementById('cooldownSeconds');

let cooldownTimer = null;

function showCooldown(seconds) {
  if (cooldownTimer) clearInterval(cooldownTimer);
  
  let remaining = seconds;
  cooldownSeconds.textContent = remaining;
  cooldownBanner.classList.remove('hidden');
  submitBtn.disabled = true;
  
  cooldownTimer = setInterval(() => {
    remaining--;
    if (remaining <= 0) {
      clearInterval(cooldownTimer);
      cooldownBanner.classList.add('hidden');
      submitBtn.disabled = false;
    } else {
      cooldownSeconds.textContent = remaining;
    }
  }, 1000);
}

contactForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const formData = new FormData(contactForm);
  const data = {
    name: formData.get('name'),
    email: formData.get('email'),
    message: formData.get('message'),
    website: formData.get('website') // honeypot
  };

  // Add hCaptcha token if present
  const hcaptchaResponse = document.querySelector('[name="h-captcha-response"]');
  if (hcaptchaResponse) {
    data['h-captcha-response'] = hcaptchaResponse.value;
  }

  submitBtn.disabled = true;
  submitBtn.textContent = 'Sending...';
  statusDiv.classList.add('hidden');

  try {
    const response = await fetch('/api/contact', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    if (!response.ok) {
      if (response.status === 429) {
        // Rate limited
        const retryAfter = result.retryAfter || 5;
        showCooldown(retryAfter);
        throw new Error(`Rate limit reached. Please wait ${retryAfter} seconds.`);
      }
      throw new Error(result.error || 'Server error');
    }
    
    // Show success message
    statusDiv.className = 'p-4 bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-lg text-green-800 dark:text-green-200';
    statusDiv.textContent = '✅ Message sent successfully! We\'ll get back to you soon.';
    statusDiv.classList.remove('hidden');
    
    // Reset form
    contactForm.reset();
    if (typeof hcaptcha !== 'undefined') hcaptcha.reset();
  } catch (err) {
    // Show error message
    statusDiv.className = 'p-4 bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg text-red-800 dark:text-red-200';
    statusDiv.textContent = `❌ ${err.message}`;
    statusDiv.classList.remove('hidden');
  } finally {
    if (!cooldownTimer) {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send Message';
    }
  }
});
</script>
