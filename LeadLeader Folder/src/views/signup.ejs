<%- include('partials/head', { title: title || 'Sign up' }) %>
<div style="max-width:400px;margin:40px auto;padding:20px">
  <h1 style="margin-bottom:24px">Sign up</h1>
  <div id="errorMsg" class="alert-error" style="display:none;padding:12px;border-radius:6px;margin-bottom:16px"></div>
  <form id="signupForm" method="post" action="/auth/signup" style="display:flex;flex-direction:column;gap:16px">
    <div>
      <label style="display:block;margin-bottom:6px;font-weight:500">Username</label>
      <input name="username" required minlength="3" maxlength="32"
             style="width:100%;padding:10px;border:1px solid var(--input-border);border-radius:6px">
      <small style="color:var(--text-muted);display:block;margin-top:4px">3-32 characters, letters, numbers, and underscores</small>
    </div>
    <div>
      <label style="display:block;margin-bottom:6px;font-weight:500">Password</label>
      <input type="password" name="password" required minlength="8" maxlength="128"
             style="width:100%;padding:10px;border:1px solid var(--input-border);border-radius:6px">
      <small style="color:var(--text-muted);display:block;margin-top:4px">At least 8 characters</small>
    </div>
    <% if (requireHCaptcha && sitekey) { %>
      <div class="h-captcha" data-sitekey="<%= sitekey %>"></div>
      <script src="https://hcaptcha.com/1/api.js" async defer></script>
    <% } %>
    <button type="submit" style="padding:12px;border-radius:6px;font-weight:600;cursor:pointer">
      Create account
    </button>
  </form>
  <p style="margin-top:20px;text-align:center">
    Have an account? <a href="/auth/login">Log in</a>
  </p>
</div>
<script>
const form = document.getElementById('signupForm');
const errorMsg = document.getElementById('errorMsg');
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  errorMsg.style.display = 'none';
  const btn = form.querySelector('button');
  btn.disabled = true;
  btn.textContent = 'Creating account...';
  
  try {
    const fd = new FormData(form);
    const r = await fetch('/auth/signup', {method:'POST', body:fd});
    const j = await r.json();
    
    if(j.ok) {
      location.href = j.redirect || '/dashboard';
    } else {
      errorMsg.textContent = j.error || 'Signup failed';
      errorMsg.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'Create account';
    }
  } catch(err) {
    errorMsg.textContent = 'Network error. Please try again.';
    errorMsg.style.display = 'block';
    btn.disabled = false;
    btn.textContent = 'Create account';
  }
});
</script>
<%- include('partials/foot') %>
